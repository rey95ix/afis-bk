// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model GeneralData {
  id_general                 Int      @id @default(autoincrement())
  nombre_sistema             String
  direccion                  String?
  razon                      String?
  nit                        String?
  nrc                        String?
  cod_actividad              String?
  desc_actividad             String?
  nombre_comercial           String?
  contactos                  String?
  correo                     String?
  cod_estable_MH             String?
  cod_estable                String?
  cod_punto_venta_MH         String?
  cod_punto_venta            String?
  ambiente                   String?  @default("00") //00=pruebas, 01=produccion
  api_facturacion_dev        String?  @default("https://apitest.dtes.mh.gob.sv/") //00=pruebas, 01=produccion
  api_facturacion_prod       String?  @default("https://api.dtes.mh.gob.sv/") //00=pruebas, 01=produccion
  public_key                 String?  @default("")
  private_key                String?  @default("")
  token_api_fac              String?  @default("")
  version_email              String?  @default("1")
  token_email                String?  @default("")
  sender_email               String?  @default("")
  text_email                 String?  @default("Gracias por su preferencia!")
  domain_email               String?  @default("")
  impuesto                   Float?   @default(0.13)
  icono_sistema              String?  @default("") @db.Text
  icono_factura              String?  @default("") @db.Text
  url_facebook               String?  @default("")
  perfil_facebook            String?  @default("")
  url_instagram              String?  @default("")
  perfil_instagram           String?  @default("")
  url_pagina_web             String?  @default("")
  url_correo_atencio         String?  @default("")
  url_maps                   String?  @default("")
  whatsapp                   String?  @default("")
  color_icono                String?  @default("")
  fecha_creacion             DateTime @default(now())
  fecha_ultima_actualizacion DateTime @default(now()) @updatedAt
}

model usuarios {
  id_usuario                     Int                             @id @default(autoincrement())
  usuario                        String
  password                       String
  nombres                        String
  apellidos                      String
  id_sucursal                    Int?
  dui                            String?
  foto                           String?                         @db.Text()
  estado                         estado                          @default(ACTIVO)
  id_rol                         Int
  roles                          roles                           @relation(fields: [id_rol], references: [id_rol], onDelete: NoAction, onUpdate: NoAction, map: "fk_usuario_rol")
  id_tipo_documento              Int?
  dTETipoDocumentoIdentificacion dTETipoDocumentoIdentificacion? @relation(fields: [id_tipo_documento], references: [id_tipo_documento], onDelete: NoAction, onUpdate: NoAction, map: "fk_usuario_tipo_documento")
  log                            log[]
  fecha_creacion                 DateTime                        @default(now())
  fecha_ultima_actualizacion     DateTime                        @default(now()) @updatedAt
  Cliente                        cliente[]
  proveedores                    proveedores[]
  compras                        compras[]
  orden_trabajo                  orden_trabajo[]
  agenda_visitas                 agenda_visitas[]
  ot_historial_estado            ot_historial_estado[]
  ot_evidencias                  ot_evidencias[]
}

model cliente {
  id_cliente                 Int      @id @default(autoincrement())
  id_usuario                 Int
  usuario                    usuarios @relation(fields: [id_usuario], references: [id_usuario], onDelete: NoAction, onUpdate: NoAction, map: "fk_cliente_usuario")
  titular                    String
  fecha_nacimiento           DateTime
  dui                        String   @unique // No. Único de identidad (DUI)
  nit                        String? // No. Identificación tributaria (NIT)
  empresa_trabajo            String
  correo_electronico         String
  telefono1                  String
  telefono2                  String?
  referencia1                String
  referencia1_telefono       String
  referencia2                String
  referencia2_telefono       String
  estado                     estado   @default(ACTIVO)
  fecha_creacion             DateTime @default(now())
  fecha_ultima_actualizacion DateTime @default(now()) @updatedAt

  direcciones      clienteDirecciones[]
  datosfacturacion clienteDatosFacturacion[]
  documentos       clienteDocumentos[]
  ticket_soporte   ticket_soporte[]
  orden_trabajo    orden_trabajo[]
}

model clienteDocumentos {
  id_cliente_documento       Int      @id @default(autoincrement())
  id_cliente                 Int
  cliente                    cliente  @relation(fields: [id_cliente], references: [id_cliente], onDelete: Cascade, onUpdate: NoAction, map: "fk_cliente_documentos_cliente")
  tipo_documento             String // DUI_FRENTE, DUI_TRASERA, NIT_FRENTE, NIT_TRASERA, RECIBO
  nombre_archivo             String
  ruta_archivo               String   @db.Text
  mimetype                   String
  size                       Int
  estado                     estado   @default(ACTIVO)
  fecha_creacion             DateTime @default(now())
  fecha_ultima_actualizacion DateTime @default(now()) @updatedAt

  @@index([id_cliente])
}

model clienteDatosFacturacion {
  id_cliente_datos_facturacion   Int                             @id @default(autoincrement())
  id_cliente                     Int
  tipo                           String                          @default("PERSONA") // PERSONA o EMPRESA
  cliente                        cliente                         @relation(fields: [id_cliente], references: [id_cliente], onDelete: NoAction, onUpdate: NoAction, map: "fk_cliente_datos_facturacion_cliente")
  id_tipo_documento              Int?
  dTETipoDocumentoIdentificacion dTETipoDocumentoIdentificacion? @relation(fields: [id_tipo_documento], references: [id_tipo_documento], onDelete: NoAction, onUpdate: NoAction, map: "fk_cliente_datos_facturacion_tipo_documento")
  id_actividad                   Int?
  dTEActividadEconomica          dTEActividadEconomica?          @relation(fields: [id_actividad], references: [id_actividad], onDelete: NoAction, onUpdate: NoAction, map: "fk_cliente_datos_facturacion_actividad_economica")
  nombre_empresa                 String
  nit                            String?
  nrc                            String?
  telefono                       String?
  correo_electronico             String?
  direccion_facturacion          String?
  id_municipio                   Int?
  municipio                      municipios?                     @relation(fields: [id_municipio], references: [id_municipio], onDelete: NoAction, onUpdate: NoAction, map: "fk_cliente_datos_facturacion_municipio")
  id_departamento                Int?
  departamento                   departamentos?                  @relation(fields: [id_departamento], references: [id_departamento], onDelete: NoAction, onUpdate: NoAction, map: "fk_cliente_datos_facturacion_departamento")
  estado                         estado                          @default(ACTIVO)
  fecha_creacion                 DateTime                        @default(now())
  fecha_ultima_actualizacion     DateTime                        @default(now()) @updatedAt
}

model clienteDirecciones {
  id_cliente_direccion       Int              @id @default(autoincrement())
  id_cliente                 Int
  cliente                    cliente          @relation(fields: [id_cliente], references: [id_cliente], onDelete: NoAction, onUpdate: NoAction, map: "fk_cliente_direccion_cliente")
  direccion                  String
  id_colonia                 Int?
  colonias                   colonias?        @relation(fields: [id_colonia], references: [id_colonia], onDelete: NoAction, onUpdate: NoAction, map: "fk_cliente_direccion_colonia")
  id_municipio               Int
  municipio                  municipios?      @relation(fields: [id_municipio], references: [id_municipio], onDelete: NoAction, onUpdate: NoAction, map: "fk_cliente_direccion_municipio")
  id_departamento            Int
  departamento               departamentos?   @relation(fields: [id_departamento], references: [id_departamento], onDelete: NoAction, onUpdate: NoAction, map: "fk_cliente_direccion_departamento")
  codigo_postal              String?
  estado                     estado           @default(ACTIVO)
  fecha_creacion             DateTime         @default(now())
  fecha_ultima_actualizacion DateTime         @default(now()) @updatedAt
  ticket_soporte             ticket_soporte[]
  orden_trabajo              orden_trabajo[]
}

model departamentos {
  id_departamento            Int                       @id @default(autoincrement())
  nombre                     String
  codigo                     String?
  codigo_iso                 String
  estado                     estado                    @default(ACTIVO)
  Municipios                 municipios[]
  fecha_creacion             DateTime                  @default(now())
  fecha_ultima_actualizacion DateTime                  @default(now()) @updatedAt
  clienteDirecciones         clienteDirecciones[]
  clienteDatosFacturacion    clienteDatosFacturacion[]
}

model municipios {
  id_municipio               Int                       @id @default(autoincrement())
  nombre                     String
  codigo                     String?
  estado                     estado                    @default(ACTIVO)
  id_departamento            Int                       @default(0)
  Departamento               departamentos             @relation(fields: [id_departamento], references: [id_departamento], onDelete: NoAction, onUpdate: NoAction, map: "fk_municipio_departamento")
  Sucursales                 sucursales[]
  fecha_creacion             DateTime                  @default(now())
  fecha_ultima_actualizacion DateTime                  @default(now()) @updatedAt
  clienteDirecciones         clienteDirecciones[]
  colonias                   colonias[]
  clienteDatosFacturacion    clienteDatosFacturacion[]
  proveedores                proveedores[]

  @@index([id_departamento], name: "fk_municipio_departamento_id")
}

model colonias {
  id_colonia                 Int                  @id @default(autoincrement())
  nombre                     String
  codigo                     String?
  estado                     estado               @default(ACTIVO)
  id_municipio               Int                  @default(0)
  Municipio                  municipios           @relation(fields: [id_municipio], references: [id_municipio], onDelete: NoAction, onUpdate: NoAction, map: "fk_colonia_municipio")
  fecha_creacion             DateTime             @default(now())
  fecha_ultima_actualizacion DateTime             @default(now()) @updatedAt
  clienteDirecciones         clienteDirecciones[]

  @@index([id_municipio], name: "fk_colonia_municipio_id")
}

model sucursales {
  id_sucursal                Int                     @id @default(autoincrement())
  nombre                     String
  color                      String?
  complemento                String?
  telefono                   String?
  correo                     String?
  cod_estable_MH             String?                 @default("M001")
  cod_estable                String?                 @default("M001")
  cod_punto_venta_MH         String?                 @default("P001")
  cod_punto_venta            String?                 @default("P001")
  id_municipio               Int?
  Municipio                  municipios?             @relation(fields: [id_municipio], references: [id_municipio], onDelete: NoAction, onUpdate: NoAction, map: "fk_sucursal_municipio")
  id_tipo_establecimiento    Int?
  DTETipoEstablecimiento     dTETipoEstablecimiento? @relation(fields: [id_tipo_establecimiento], references: [id_tipo_establecimiento], onDelete: NoAction, onUpdate: NoAction, map: "fk_sucursal_tipo_establecimiento")
  icono_factura              String?                 @default("") @db.Text
  estado                     estado                  @default(ACTIVO)
  facturasBloques            facturasBloques[]
  bodegas                    bodegas[]
  compras                    compras[]
  fecha_creacion             DateTime                @default(now())
  fecha_ultima_actualizacion DateTime                @default(now()) @updatedAt
}

model bodegas {
  id_bodega                  Int          @id @default(autoincrement())
  nombre                     String
  descripcion                String?
  id_sucursal                Int
  sucursal                   sucursales   @relation(fields: [id_sucursal], references: [id_sucursal])
  estado                     estado       @default(ACTIVO)
  fecha_creacion             DateTime     @default(now())
  fecha_ultima_actualizacion DateTime     @default(now()) @updatedAt
  compras                    compras[]
  estantes                   estantes[]
  inventario                 inventario[]
}

model estantes {
  id_estante Int          @id @default(autoincrement())
  nombre     String
  estado     estado       @default(ACTIVO)
  id_bodega  Int
  bodegas    bodegas      @relation(fields: [id_bodega], references: [id_bodega], onDelete: NoAction, onUpdate: NoAction)
  inventario inventario[]
}

model categorias {
  id_categoria               Int        @id @default(autoincrement())
  nombre                     String
  estado                     estado     @default(ACTIVO)
  catalogo                   catalogo[]
  fecha_creacion             DateTime   @default(now())
  fecha_ultima_actualizacion DateTime   @default(now()) @updatedAt
}

model catalogo {
  id_catalogo                Int              @id @default(autoincrement())
  id_categoria               Int
  categoria                  categorias       @relation(fields: [id_categoria], references: [id_categoria])
  codigo                     String
  codigo_proveedor           String?
  nombre                     String
  descripcion                String?
  estado                     estado           @default(ACTIVO)
  fecha_creacion             DateTime         @default(now())
  fecha_ultima_actualizacion DateTime         @default(now()) @updatedAt
  comprasDetalle             comprasDetalle[]
  inventario                 inventario[]
  kardex                     kardex[]
}

model log {
  id                         Int       @id @default(autoincrement())
  accion                     String
  descripcion                String?
  fecha_creacion             DateTime  @default(now())
  id_usuario                 Int?
  Usuarios                   usuarios? @relation(fields: [id_usuario], references: [id_usuario])
  fecha_ultima_actualizacion DateTime  @default(now()) @updatedAt
}

enum estado {
  ACTIVO
  SUPENDIDO
  INACTIVO
}

model roles {
  id_rol                     Int        @id @default(autoincrement())
  nombre                     String
  estado                     estado     @default(ACTIVO)
  usuarios                   usuarios[]
  fecha_creacion             DateTime   @default(now())
  fecha_ultima_actualizacion DateTime   @default(now()) @updatedAt
}

model facturasBloques {
  id_bloque                  Int           @id @default(autoincrement())
  tira                       String
  autorizacion               String        @default("")
  resolucion                 String?       @default("")
  desde                      Int
  hasta                      Int
  actual                     Int
  serie                      String
  id_tipo_factura            Int           @default(0)
  Tipo                       facturasTipos @relation(fields: [id_tipo_factura], references: [id_tipo_factura], onDelete: NoAction, onUpdate: NoAction, map: "fk_fatura_bloque_tipo")
  id_sucursal                Int?
  Sucursal                   sucursales?   @relation(fields: [id_sucursal], references: [id_sucursal], onDelete: NoAction, onUpdate: NoAction, map: "fk_fatura_bloque_sucursal")
  estado                     estado        @default(ACTIVO)
  fecha_creacion             DateTime      @default(now())
  fecha_ultima_actualizacion DateTime      @default(now()) @updatedAt

  @@index([id_sucursal], name: "fk_fatura_bloque_sucursal_id")
  @@index([id_tipo_factura], name: "fk_fatura_bloque_tipo_id")
}

model facturasTipos {
  id_tipo_factura            Int               @id @default(autoincrement())
  nombre                     String
  codigo                     String?
  version                    Int?
  estado                     estado            @default(ACTIVO)
  activo                     estado            @default(ACTIVO)
  Bloques                    facturasBloques[]
  fecha_creacion             DateTime          @default(now())
  fecha_ultima_actualizacion DateTime          @default(now()) @updatedAt
  compras                    compras[]
}

// catalogos de factura electronica

model dTEActividadEconomica {
  id_actividad               Int                       @id @default(autoincrement())
  nombre                     String
  codigo                     String
  estado                     estado                    @default(ACTIVO)
  fecha_creacion             DateTime                  @default(now())
  fecha_ultima_actualizacion DateTime                  @default(now()) @updatedAt
  // cliente      Cliente[]
  // Proveedores  Proveedores[]
  clienteDatosFacturacion    clienteDatosFacturacion[]
  proveedores                proveedores[]
}

model dTETipoEstablecimiento {
  id_tipo_establecimiento    Int          @id @default(autoincrement())
  nombre                     String
  codigo                     String
  estado                     estado       @default(ACTIVO)
  Sucursales                 sucursales[]
  fecha_creacion             DateTime     @default(now())
  fecha_ultima_actualizacion DateTime     @default(now()) @updatedAt
}

model dTETipoInvalidacion {
  id_tipo_invalidacion       Int      @id @default(autoincrement())
  nombre                     String
  codigo                     String
  estado                     estado   @default(ACTIVO)
  fecha_creacion             DateTime @default(now())
  fecha_ultima_actualizacion DateTime @default(now()) @updatedAt
}

model dTETipoContingencia {
  id_tipo_contingencia       Int      @id @default(autoincrement())
  nombre                     String
  estado                     estado   @default(ACTIVO)
  fecha_creacion             DateTime @default(now())
  fecha_ultima_actualizacion DateTime @default(now()) @updatedAt
}

model dTETipoDocumentoIdentificacion {
  id_tipo_documento          Int                       @id @default(autoincrement())
  nombre                     String
  codigo                     String
  estado                     estado                    @default(ACTIVO)
  usuarios                   usuarios[]
  fecha_creacion             DateTime                  @default(now())
  fecha_ultima_actualizacion DateTime                  @default(now()) @updatedAt
  // cliente           Cliente[]
  // Proveedores       Proveedores[]
  clienteDatosFacturacion    clienteDatosFacturacion[]
  proveedores                proveedores[]
}

model dTERetencionIvaMh {
  id_dte_retencion_iva_mh    Int      @id @default(autoincrement())
  codigo                     String
  valor                      String
  fecha_creacion             DateTime @default(now())
  fecha_ultima_actualizacion DateTime @default(now()) @updatedAt
}

model dTETipoGeneracionDocumento {
  id_dte_tipo_generacion_documento Int      @id @default(autoincrement())
  codigo                           Int
  valor                            String
  fecha_creacion                   DateTime @default(now())
  fecha_ultima_actualizacion       DateTime @default(now()) @updatedAt
}

model dTETipoServicioMedico {
  id_dte_tipo_servicio_medico Int      @id @default(autoincrement())
  codigo                      Int
  valor                       String
  fecha_creacion              DateTime @default(now())
  fecha_ultima_actualizacion  DateTime @default(now()) @updatedAt
}

model dTETipoItem {
  id_dte_tipo_item           Int      @id @default(autoincrement())
  codigo                     Int
  valor                      String
  fecha_creacion             DateTime @default(now())
  fecha_ultima_actualizacion DateTime @default(now()) @updatedAt
}

model dTEUnidadDeMedida {
  id_unidad_de_medida        Int      @id @default(autoincrement())
  codigo                     String
  valor                      String
  fecha_creacion             DateTime @default(now())
  fecha_ultima_actualizacion DateTime @default(now()) @updatedAt
}

model dTETributosAplicadosPorItem {
  id_tributos_aplicados_por_item Int      @id @default(autoincrement())
  codigo                         String
  valor                          String
  fecha_creacion                 DateTime @default(now())
  fecha_ultima_actualizacion     DateTime @default(now()) @updatedAt
}

model dTETributosAplicadosPorItemCuerpo {
  id_tributos_aplicados_por_item_cuerpo Int      @id @default(autoincrement())
  codigo                                String
  valor                                 String
  fecha_creacion                        DateTime @default(now())
  fecha_ultima_actualizacion            DateTime @default(now()) @updatedAt
}

model dTEImpuestosAdValoremAplicadosPorItem {
  id_impuestos_ad_valorem_aplicados_por_item Int      @id @default(autoincrement())
  codigo                                     String
  valor                                      String
  fecha_creacion                             DateTime @default(now())
  fecha_ultima_actualizacion                 DateTime @default(now()) @updatedAt
}

model dTECondicionDeLaOperacion {
  id_condicion_de_la_operacion Int      @id @default(autoincrement())
  codigo                       Int
  valor                        String
  fecha_creacion               DateTime @default(now())
  fecha_ultima_actualizacion   DateTime @default(now()) @updatedAt
}

model dTEPlazo {
  id_plazo                   Int      @id @default(autoincrement())
  codigo                     String
  valor                      String
  fecha_creacion             DateTime @default(now())
  fecha_ultima_actualizacion DateTime @default(now()) @updatedAt
}

model dTEFormaPago {
  id                         Int       @id @default(autoincrement())
  codigo                     String
  valor                      String
  fecha_creacion             DateTime  @default(now())
  fecha_ultima_actualizacion DateTime  @default(now()) @updatedAt
  compras                    compras[]
}

model dTEPais {
  id_pais                    Int      @id @default(autoincrement())
  codigo                     String
  valor                      String
  fecha_creacion             DateTime @default(now())
  fecha_ultima_actualizacion DateTime @default(now()) @updatedAt
  // cliente Cliente[]
}

model dTEOtrosDocumentosAsociados {
  id_otros_documentos_asociados Int      @id @default(autoincrement())
  codigo                        Int
  valor                         String
  fecha_creacion                DateTime @default(now())
  fecha_ultima_actualizacion    DateTime @default(now()) @updatedAt
}

model dTETiposDeDocumentosEnContingencia {
  id_tipos_de_documentos_en_contingencia Int      @id @default(autoincrement())
  codigo                                 String
  valor                                  String
  fecha_creacion                         DateTime @default(now())
  fecha_ultima_actualizacion             DateTime @default(now()) @updatedAt
}

model dTETituloAQueSeRemiteLosBienes {
  id_titulo_a_que_se_remite_los_bienes Int      @id @default(autoincrement())
  codigo                               String
  valor                                String
  fecha_creacion                       DateTime @default(now())
  fecha_ultima_actualizacion           DateTime @default(now()) @updatedAt
}

model dTECategoriaDeBienYServicio {
  id_categoria               Int      @id @default(autoincrement())
  codigo                     Int
  valor                      String
  fecha_creacion             DateTime @default(now())
  fecha_ultima_actualizacion DateTime @default(now()) @updatedAt
}

model dTERecintoFiscal {
  id_recinto_fiscal          Int      @id @default(autoincrement())
  codigo                     String
  valor                      String
  fecha_creacion             DateTime @default(now())
  fecha_ultima_actualizacion DateTime @default(now()) @updatedAt
}

model dTERegimen {
  id_regimen                 Int      @id @default(autoincrement())
  codigo                     String
  valor                      String
  fecha_creacion             DateTime @default(now())
  fecha_ultima_actualizacion DateTime @default(now()) @updatedAt
}

model dTETipoDePersona {
  id_tipoDePersona           Int      @id @default(autoincrement())
  codigo                     Int
  valor                      String
  fecha_creacion             DateTime @default(now())
  fecha_ultima_actualizacion DateTime @default(now()) @updatedAt
}

model dTETransporte {
  id_transporte              Int      @id @default(autoincrement())
  codigo                     Int
  valor                      String
  fecha_creacion             DateTime @default(now())
  fecha_ultima_actualizacion DateTime @default(now()) @updatedAt
}

model dTEIncoterms {
  id_incoterms               Int      @id @default(autoincrement())
  codigo                     String
  valor                      String
  fecha_creacion             DateTime @default(now())
  fecha_ultima_actualizacion DateTime @default(now()) @updatedAt
}

model dTEDomicilioFiscal {
  id_domicilioFiscal         Int      @id @default(autoincrement())
  codigo                     Int
  valor                      String
  fecha_creacion             DateTime @default(now())
  fecha_ultima_actualizacion DateTime @default(now()) @updatedAt
}

// ======================================================   Estrutura de INVENTARIO 
model proveedores {
  id_proveedor                   Int                             @id @default(autoincrement())
  nombre_razon_social            String?                         @default("")
  nombre_comercial               String?                         @default("")
  registro_nrc                   String?                         @default("")
  numero_documento               String?                         @default("")
  id_tipo_documento              Int?
  dTETipoDocumentoIdentificacion dTETipoDocumentoIdentificacion? @relation(fields: [id_tipo_documento], references: [id_tipo_documento], onDelete: NoAction, onUpdate: NoAction, map: "fk_proveedor_tipo_documento")
  id_municipio                   Int?                            @default(0)
  Municipio                      municipios?                     @relation(fields: [id_municipio], references: [id_municipio], onDelete: NoAction, onUpdate: NoAction, map: "fk_proveedor_municipio")
  direccion                      String?                         @default("")
  telefono                       String?                         @default("")
  correo                         String?                         @default("")
  dias_credito                   String?                         @default("0")
  estado                         estado                          @default(ACTIVO)
  fecha_creacion                 DateTime                        @default(now())
  nombre_contac_1                String?                         @default("")
  telefono_contac_1              String?                         @default("")
  correo_contac_1                String?                         @default("")
  nombre_contac_2                String?                         @default("")
  telefono_contac_2              String?                         @default("")
  correo_contac_2                String?                         @default("")
  id_actividad_economica         Int?
  dTEActividadEconomica          dTEActividadEconomica?          @relation(fields: [id_actividad_economica], references: [id_actividad], onDelete: NoAction, onUpdate: NoAction, map: "fk_proveedor_actividad_economica")
  id_usuario                     Int
  usuario                        usuarios                        @relation(fields: [id_usuario], references: [id_usuario], onDelete: NoAction, onUpdate: NoAction, map: "fk_proveedor_usuario")
  compras                        compras[]
  fecha_actualizacion            DateTime                        @default(now()) @updatedAt
}

model compras {
  id_compras          Int              @id @default(autoincrement())
  numero_factura      String           @default("0")
  numero_quedan       String?          @default("0")
  detalle             String?          @db.Text
  nombre_proveedor    String?          @default("")
  dui_proveedor       String?          @default("")
  no_cheque           String?          @default("") // esto para cuando sea de credito y se paga
  id_proveedor        Int?
  proveedor           proveedores?     @relation(fields: [id_proveedor], references: [id_proveedor], onDelete: NoAction, onUpdate: NoAction, map: "fk_compras_proveedor")
  id_forma_pago       Int?
  dTEFormaPago        dTEFormaPago?    @relation(fields: [id_forma_pago], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_compras_metodo_pago")
  id_usuario          Int
  usuario             usuarios         @relation(fields: [id_usuario], references: [id_usuario], onDelete: NoAction, onUpdate: NoAction, map: "fk_compra_usuario")
  dias_credito        Int?             @default(0)
  subtotal            Float?           @default(0)
  descuento           Float?           @default(0)
  cesc                Float?           @default(0)
  fovial              Float?           @default(0)
  cotrans             Float?           @default(0)
  iva                 Float?           @default(0)
  iva_retenido        Float?           @default(0)
  iva_percivido       Float?           @default(0)
  total               Float?           @default(0)
  estado              estado           @default(ACTIVO)
  id_sucursal         Int?
  sucursales          sucursales?      @relation(fields: [id_sucursal], references: [id_sucursal], onDelete: NoAction, onUpdate: NoAction, map: "fk_compras_sucursal")
  id_bodega           Int?
  bodegas             bodegas?         @relation(fields: [id_bodega], references: [id_bodega], onDelete: NoAction, onUpdate: NoAction, map: "fk_compras_bodega")
  id_tipo_factura     Int?             @default(2)
  facturasTipos       facturasTipos?   @relation(fields: [id_tipo_factura], references: [id_tipo_factura], onDelete: NoAction, onUpdate: NoAction, map: "fk_compras_tipo_factura")
  ComprasDetalle      comprasDetalle[]
  fecha_creacion      DateTime         @default(now())
  fecha_actualizacion DateTime         @default(now())
  fecha_factura       DateTime?
  fecha_de_pago       DateTime?
  is_dte              Boolean          @default(false) // false=Fisica, true=Electronica
  json_dte            String?          @db.Text
  numeroControl       String?          @default("")
  codigoGeneracion    String?          @default("")

  @@index([id_tipo_factura], name: "fk_compras_tipo_factura_id")
  @@index([id_sucursal], name: "fk_compras_sucursal_id")
  @@index([id_bodega], name: "fk_compras_bodega_id")
  @@index([id_usuario], name: "fk_compra_usuario_id")
  @@index([id_proveedor], name: "fk_compras_proveedor_id")
  @@map("Compras")
}

model comprasDetalle {
  id_compras_detalle   Int          @id @default(autoincrement())
  id_compras           Int
  Compras              compras      @relation(fields: [id_compras], references: [id_compras], onDelete: NoAction, onUpdate: NoAction, map: "fk_compra_detalle")
  id_catalogo          Int?
  catalogo             catalogo?    @relation(fields: [id_catalogo], references: [id_catalogo], onDelete: NoAction, onUpdate: NoAction, map: "fk_compras_detalle_catalogo")
  codigo               String?      @db.Text
  nombre               String
  descripcion          String?      @db.Text
  costo_unitario       Float?       @default(0)
  cantidad             Float        @default(0)
  cantidad_inventario  Float        @default(0)
  subtotal             Float?       @default(0)
  descuento_porcentaje Float?       @default(0)
  descuento_monto      Float?       @default(0)
  iva                  Float?       @default(0)
  total                Float?       @default(0)
  fecha_creacion       DateTime     @default(now())
  kardex               kardex[]
  inventario           inventario[]

  @@index([id_compras], name: "fk_compra_detalle_id")
  @@index([id_catalogo], name: "fk_compras_detalle_catalogo_id")
}

model inventario {
  id_inventario      Int             @id @default(autoincrement())
  id_catalogo        Int
  Catalogo           catalogo        @relation(fields: [id_catalogo], references: [id_catalogo], onDelete: NoAction, onUpdate: NoAction, map: "fk_inventario_catalogo")
  id_compras_detalle Int?
  ComprasDetalle     comprasDetalle? @relation(fields: [id_compras_detalle], references: [id_compras_detalle], onDelete: NoAction, onUpdate: NoAction, map: "fk_inventario_detalle")
  id_bodega          Int?
  bodegas            bodegas?        @relation(fields: [id_bodega], references: [id_bodega], onDelete: NoAction, onUpdate: NoAction, map: "fk_inventario_bodega")
  id_estante         Int?
  estantes           estantes?       @relation(fields: [id_estante], references: [id_estante], onDelete: NoAction, onUpdate: NoAction, map: "fk_inventario_estante")
  costo_unitario     Float?          @default(0)
  existencia         Int?            @default(0)
  costo_total        Float?          @default(0)

  @@index([id_bodega], name: "fk_inventario_bodega_id")
  @@index([id_catalogo], name: "fk_inventario_catalogo_id")
  @@index([id_compras_detalle], name: "fk_inventario_detalle_id")
}

model kardex {
  id_kardex           Int             @id @default(autoincrement())
  id_catalogo         Int
  Catalogo            catalogo        @relation(fields: [id_catalogo], references: [id_catalogo], onDelete: NoAction, onUpdate: NoAction, map: "fk_kardex_catalogo")
  id_compras_detalle  Int?
  ComprasDetalle      comprasDetalle? @relation(fields: [id_compras_detalle], references: [id_compras_detalle], onDelete: NoAction, onUpdate: NoAction, map: "fk_kardex_detalle")
  tipo_movimiento     Int             @default(1) // 1=entrada, 2=salida
  id_factura          Int?
  descripcion         String?         @db.Text
  costo               Float?          @default(0)
  cantidad            Float?          @default(0)
  subtotal            Float?          @default(0)
  costo_promedio      Float?          @default(0)
  inventario          Float?          @default(0)
  total               Float?          @default(0)
  fecha_actualizacion DateTime        @default(now())
  fecha_creacion      DateTime        @default(now()) @db.Timestamp()

  @@index([id_catalogo], name: "fk_kardex_catalogo_id")
  @@index([id_compras_detalle], name: "fk_kardex_detalle_id")
}

//ORDEN DE TRABAJO MODELS
enum estado_ticket {
  ABIERTO
  EN_DIAGNOSTICO
  ESCALADO
  CERRADO
  CANCELADO
}

enum canal_contacto {
  TELEFONO
  WHATSAPP
  EMAIL
  APP
  WEB
}

enum severidad {
  BAJA
  MEDIA
  ALTA
  CRITICA
}

enum estado_orden {
  PENDIENTE_ASIGNACION
  ASIGNADA
  AGENDADA
  EN_RUTA
  EN_PROGRESO
  EN_ESPERA_CLIENTE
  REPROGRAMADA
  COMPLETADA
  CANCELADA
}

enum tipo_orden {
  INCIDENCIA
  INSTALACION
  MANTENIMIENTO
  REUBICACION
  RETIRO
  MEJORA
}

enum resultado_orden {
  RESUELTO
  NO_RESUELTO
  REQUIERE_SEGUNDA_VISITA
  CLIENTE_AUSENTE
  ACCESO_DENEGADO
  FALLO_EQUIPO
}

model ticket_soporte {
  id_ticket               Int                   @id @default(autoincrement())
  id_cliente              Int
  cliente                 cliente               @relation(fields: [id_cliente], references: [id_cliente])
  canal                   canal_contacto
  descripcion_problema    String
  severidad               severidad             @default(MEDIA)
  id_direccion_servicio   Int // dirección del cliente donde ocurre el problema
  direccion_servicio      clienteDirecciones    @relation(fields: [id_direccion_servicio], references: [id_cliente_direccion])
  diagnostico_inicial     String? // texto libre del agente
  id_diagnostico_catalogo Int?
  diagnostico_catalogo    diagnostico_catalogo? @relation(fields: [id_diagnostico_catalogo], references: [id_diagnostico])
  pruebas_remotas         String? // ping, traceroute, potencia, etc.
  requiere_visita         Boolean               @default(false)
  estado                  estado_ticket         @default(ABIERTO)
  fecha_apertura          DateTime              @default(now())
  fecha_cierre            DateTime?
  cerrado_por_usuario     Int?
  observaciones_cierre    String?
  ordenes                 orden_trabajo[] // 1 ticket puede generar múltiples OT (reprogramaciones, etc.)
}

model diagnostico_catalogo {
  id_diagnostico Int              @id @default(autoincrement())
  codigo         String           @unique // ej: LOS_ROJO, POTENCIA_BAJA, CPE_SIN_IP, SNR_BAJO
  nombre         String
  descripcion    String?
  activo         Boolean          @default(true)
  created_at     DateTime         @default(now())
  tickets        ticket_soporte[]
}

model solucion_catalogo {
  id_solucion    Int              @id @default(autoincrement())
  codigo         String           @unique // ej: REEMPLAZO_ONU, RECONECTOR, AJUSTE_POTENCIA, CAMBIO_PUERTO_OLT
  nombre         String
  descripcion    String?
  activo         Boolean          @default(true)
  created_at     DateTime         @default(now())
  ot_actividades ot_actividades[]
}

model motivo_cierre_catalogo {
  id_motivo  Int             @id @default(autoincrement())
  codigo     String          @unique
  nombre     String
  activo     Boolean         @default(true)
  created_at DateTime        @default(now())
  ordenes    orden_trabajo[]
}

model orden_trabajo {
  id_orden                   Int                     @id @default(autoincrement())
  codigo                     String                  @unique // OT-YYYYMM-#####
  id_ticket                  Int?
  ticket                     ticket_soporte?         @relation(fields: [id_ticket], references: [id_ticket])
  tipo                       tipo_orden
  estado                     estado_orden            @default(PENDIENTE_ASIGNACION)
  id_cliente                 Int
  cliente                    cliente                 @relation(fields: [id_cliente], references: [id_cliente])
  id_direccion_servicio      Int
  direccion_servicio         clienteDirecciones      @relation(fields: [id_direccion_servicio], references: [id_cliente_direccion])
  id_tecnico_asignado        Int?
  tecnico_asignado           usuarios?               @relation(fields: [id_tecnico_asignado], references: [id_usuario])
  ventana_programada_inicio  DateTime?
  ventana_programada_fin     DateTime?
  fecha_asignacion           DateTime?
  fecha_llegada              DateTime?
  fecha_inicio_trabajo       DateTime?
  fecha_fin_trabajo          DateTime?
  resultado                  resultado_orden?
  id_motivo_cierre           Int?
  motivo_cierre              motivo_cierre_catalogo? @relation(fields: [id_motivo_cierre], references: [id_motivo])
  observaciones_tecnico      String?
  firma_cliente_url          String? // evidencia firma
  calificacion_cliente       Int? // 1-5
  notas_cierre               String?
  fecha_creacion             DateTime                @default(now())
  fecha_ultima_actualizacion DateTime                @updatedAt
  actividades                ot_actividades[]
  materiales                 ot_materiales[]
  evidencias                 ot_evidencias[]
  agendas                    agenda_visitas[]
  historico_estados          ot_historial_estado[]
}

model ot_historial_estado {
  id_historial Int           @id @default(autoincrement())
  id_orden     Int
  orden        orden_trabajo @relation(fields: [id_orden], references: [id_orden])
  estado       estado_orden
  comentario   String?
  cambiado_por Int // id_usuario que ejecuta el cambio
  tecnico      usuarios?     @relation(fields: [cambiado_por], references: [id_usuario])
  fecha_cambio DateTime      @default(now())
}

model ot_actividades {
  id_actividad    Int                @id @default(autoincrement())
  id_orden        Int
  orden           orden_trabajo      @relation(fields: [id_orden], references: [id_orden])
  id_solucion     Int?
  solucion        solucion_catalogo? @relation(fields: [id_solucion], references: [id_solucion])
  descripcion     String // p.ej. "Ajuste potencia en OLT", "Cambio conector SC/APC"
  valor_medido    String? // potencia dBm, SNR, latencias
  requerido_firma Boolean            @default(false)
  completado      Boolean            @default(false)
  fecha_creacion  DateTime           @default(now())
}

model ot_materiales {
  id_material    Int           @id @default(autoincrement())
  id_orden       Int
  orden          orden_trabajo @relation(fields: [id_orden], references: [id_orden])
  sku            String
  nombre         String
  cantidad       Int
  serie          String? // serie de ONU/CPE si aplica
  costo_unitario Decimal?      @db.Decimal(10, 2)
  fecha_registro DateTime      @default(now())
}

model ot_evidencias {
  id_evidencia Int           @id @default(autoincrement())
  id_orden     Int
  orden        orden_trabajo @relation(fields: [id_orden], references: [id_orden])
  tipo         String // foto_antes, foto_despues, speedtest, firma, audio
  url          String
  metadata     String? // JSON: { "ping": ..., "download": ... }
  fecha_subida DateTime      @default(now())
  subido_por   Int // id_usuario
  tecnico      usuarios?     @relation(fields: [subido_por], references: [id_usuario])
}

model agenda_visitas {
  id_agenda      Int           @id @default(autoincrement())
  id_orden       Int
  orden          orden_trabajo @relation(fields: [id_orden], references: [id_orden])
  inicio         DateTime
  fin            DateTime
  id_tecnico     Int?
  tecnico        usuarios?     @relation(fields: [id_tecnico], references: [id_usuario])
  motivo         String? // reprogramación, coordinación con cliente, lluvia, etc.
  activo         Boolean       @default(true) // solo un slot activo por OT
  creado_por     Int
  fecha_creacion DateTime      @default(now())
}
