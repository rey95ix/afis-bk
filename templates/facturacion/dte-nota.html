<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>{{:nombreFactura}} - {{:identificacion.numeroControl}}</title>
    {{*
        // Converter para 4 decimales (items)
        $.views.converters("dec4", function(val) {
            if (val === null || val === undefined) return "0.0000";
            return Number(val).toFixed(4);
        });

        // Converter para 2 decimales (totales)
        $.views.converters("dec2", function(val) {
            if (val === null || val === undefined) return "0.00";
            return Number(val).toFixed(2);
        });
    }}
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 10px;
            line-height: 1.3;
            color: #333;
            padding: 10mm;
        }

        .header {
            display: flex;
            margin-bottom: 15px;
        }

        .header-left {
            width: 30%;
            text-align: center;
        }

        .header-left img {
            max-width: 120px;
            max-height: 80px;
        }

        .header-right {
            width: 70%;
            border: 3px solid {{:colorBack}};
            border-radius: 8px;
            padding: 10px;
        }

        .doc-type {
            text-align: center;
            font-size: 11px;
            margin-bottom: 8px;
        }

        .doc-type.invalid {
            color: #c62828;
            font-weight: bold;
        }

        .doc-type.valid {
            font-weight: bold;
        }

        .doc-name {
            text-align: center;
            font-size: 13px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }

        .header-content {
            display: flex;
        }

        .qr-container {
            width: 80px;
            text-align: center;
        }

        .qr-container img {
            width: 75px;
            height: 75px;
        }

        .doc-info {
            flex: 1;
            padding-left: 10px;
        }

        .doc-info-row {
            display: flex;
            margin-bottom: 4px;
        }

        .doc-info-label {
            font-weight: bold;
            width: 130px;
            font-size: 9px;
        }

        .doc-info-value {
            flex: 1;
            background-color: {{:colorBack}};
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 9px;
            word-break: break-all;
        }

        .doc-meta {
            display: flex;
            margin-top: 8px;
            font-size: 9px;
        }

        .doc-meta-item {
            flex: 1;
            text-align: center;
        }

        .doc-meta-label {
            font-weight: bold;
            display: block;
        }

        .section {
            margin-bottom: 12px;
        }

        .section-title {
            font-size: 11px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .info-box {
            border: 2px solid {{:colorBack}};
            border-radius: 6px;
            padding: 8px;
        }

        .info-row {
            display: flex;
            margin-bottom: 3px;
        }

        .info-label {
            font-weight: bold;
            width: 140px;
            font-size: 9px;
        }

        .info-value {
            flex: 1;
            background-color: {{:colorBack}};
            padding: 1px 5px;
            font-size: 9px;
        }

        .columns {
            display: flex;
            gap: 10px;
        }

        .column {
            flex: 1;
        }

        .doc-relacionado {
            background-color: {{:colorBack}};
            border-radius: 6px;
            padding: 10px;
            margin-bottom: 12px;
        }

        .doc-relacionado-title {
            font-size: 11px;
            font-weight: bold;
            margin-bottom: 8px;
            text-align: center;
        }

        .doc-relacionado-content {
            display: flex;
            gap: 20px;
            justify-content: center;
        }

        .doc-relacionado-item {
            text-align: center;
        }

        .doc-relacionado-label {
            font-weight: bold;
            font-size: 9px;
            display: block;
        }

        .doc-relacionado-value {
            font-size: 9px;
            background-color: white;
            padding: 2px 8px;
            border-radius: 3px;
            display: inline-block;
            margin-top: 2px;
        }

        table.items {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 10px;
        }

        table.items thead {
            background-color: {{:colorBack}};
        }

        table.items th {
            padding: 6px 4px;
            text-align: center;
            font-size: 8px;
            font-weight: bold;
            text-transform: uppercase;
            border: 1px solid #ddd;
        }

        table.items td {
            padding: 4px;
            border: 1px solid #ddd;
            font-size: 9px;
        }

        table.items td.center {
            text-align: center;
        }

        table.items td.right {
            text-align: right;
        }

        table.items td.left {
            text-align: left;
        }

        .summary-section {
            display: flex;
            gap: 10px;
        }

        .notes-box {
            flex: 1;
            border: 2px solid {{:colorBack}};
            border-radius: 6px;
            padding: 8px;
            font-size: 9px;
            min-height: 100px;
        }

        .notes-box strong {
            display: block;
            margin-bottom: 5px;
        }

        .summary-box {
            width: 280px;
            border: 2px solid {{:colorBack}};
            border-radius: 6px;
            overflow: hidden;
        }

        .summary-row {
            display: flex;
            font-size: 9px;
        }

        .summary-row.header {
            background-color: {{:colorBack}};
            font-weight: bold;
        }

        .summary-label {
            flex: 1;
            padding: 3px 6px;
            text-align: right;
        }

        .summary-value {
            width: 80px;
            padding: 3px 6px;
            text-align: right;
            background-color: {{:colorBack}};
        }

        .summary-row.total {
            font-weight: bold;
            font-size: 10px;
        }

        .footer-section {
            margin-top: 10px;
            border: 2px solid {{:colorBack}};
            border-radius: 6px;
            padding: 8px;
        }

        .footer-row {
            display: flex;
            font-size: 9px;
        }

        .footer-item {
            flex: 1;
        }

        .footer-label {
            font-weight: bold;
        }

        @media print {
            body {
                padding: 5mm;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="header-left">
            {{if logo}}
            <img src="{{:logo}}" alt="Logo">
            {{/if}}
        </div>
        <div class="header-right">
            {{if esValidoMH}}
            <div class="doc-type valid">DOCUMENTO TRIBUTARIO ELECTRONICO</div>
            <div class="doc-name">{{:nombreFactura}}</div>
            {{else}}
            <div class="doc-type invalid">ESTE NO ES UN DOCUMENTO TRIBUTARIO ELECTRONICO</div>
            <div class="doc-name">{{:nombreFactura}} - {{:estadoDte}}</div>
            {{/if}}

            <div class="header-content">
                <div class="qr-container">
                    {{if qr}}
                    <img src="{{:qr}}" alt="QR Verificacion">
                    {{/if}}
                </div>
                <div class="doc-info">
                    <div class="doc-info-row">
                        <span class="doc-info-label">Codigo de Generacion:</span>
                        <span class="doc-info-value">{{:identificacion.codigoGeneracion}}</span>
                    </div>
                    <div class="doc-info-row">
                        <span class="doc-info-label">Numero de Control:</span>
                        <span class="doc-info-value">{{:identificacion.numeroControl}}</span>
                    </div>
                    {{if selloRecibido}}
                    <div class="doc-info-row">
                        <span class="doc-info-label">Sello de Recepcion:</span>
                        <span class="doc-info-value">{{:selloRecibido}}</span>
                    </div>
                    {{/if}}
                </div>
            </div>

            <div class="doc-meta">
                <div class="doc-meta-item">
                    <span class="doc-meta-label">Modelo de Facturacion:</span>
                    {{:identificacion.tipoModelo}}
                </div>
                <div class="doc-meta-item">
                    <span class="doc-meta-label">Tipo de Transmision:</span>
                    {{:identificacion.tipoOperacion}}
                </div>
                <div class="doc-meta-item">
                    <span class="doc-meta-label">Fecha y Hora:</span>
                    {{:identificacion.fecEmi}} {{:identificacion.horEmi}}
                </div>
            </div>
        </div>
    </div>

    <!-- Documento Relacionado -->
    {{if documentoRelacionado}}
    <div class="doc-relacionado">
        <div class="doc-relacionado-title">DOCUMENTO RELACIONADO</div>
        <div class="doc-relacionado-content">
            {{for documentoRelacionado}}
            <div class="doc-relacionado-item">
                <span class="doc-relacionado-label">Tipo Documento:</span>
                <span class="doc-relacionado-value">{{:tipoDocumento}}</span>
            </div>
            <div class="doc-relacionado-item">
                <span class="doc-relacionado-label">N Control / Generacion:</span>
                <span class="doc-relacionado-value">{{if numeroControl}}{{:numeroControl}}{{else}}{{:tipoGeneracion}}{{/if}}</span>
            </div>
            <div class="doc-relacionado-item">
                <span class="doc-relacionado-label">Fecha Emision:</span>
                <span class="doc-relacionado-value">{{:fechaEmision}}</span>
            </div>
            {{/for}}
        </div>
    </div>
    {{/if}}

    <!-- Emisor y Receptor -->
    <div class="section">
        <div class="columns">
            <div class="column">
                <div class="section-title">EMISOR</div>
                <div class="info-box">
                    <div class="info-row">
                        <span class="info-label">Nombre o razon social:</span>
                        <span class="info-value">{{:emisor.nombre}}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">NIT:</span>
                        <span class="info-value">{{:emisor.nit}}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">NRC:</span>
                        <span class="info-value">{{:emisor.nrc}}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Actividad economica:</span>
                        <span class="info-value">{{:emisor.descActividad}}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Direccion:</span>
                        <span class="info-value">{{:emisor.direccion.complemento}}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Telefono:</span>
                        <span class="info-value">{{:emisor.telefono}}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Correo:</span>
                        <span class="info-value">{{:emisor.correo}}</span>
                    </div>
                </div>
            </div>
            <div class="column">
                <div class="section-title">RECEPTOR</div>
                <div class="info-box">
                    {{if receptor.nombre}}
                    <div class="info-row">
                        <span class="info-label">Nombre o razon social:</span>
                        <span class="info-value">{{:receptor.nombre}}</span>
                    </div>
                    {{/if}}
                    {{if receptor.nit}}
                    <div class="info-row">
                        <span class="info-label">NIT:</span>
                        <span class="info-value">{{:receptor.nit}}</span>
                    </div>
                    {{/if}}
                    {{if receptor.nrc}}
                    <div class="info-row">
                        <span class="info-label">NRC:</span>
                        <span class="info-value">{{:receptor.nrc}}</span>
                    </div>
                    {{/if}}
                    {{if receptor.descActividad}}
                    <div class="info-row">
                        <span class="info-label">Actividad economica:</span>
                        <span class="info-value">{{:receptor.descActividad}}</span>
                    </div>
                    {{/if}}
                    {{if receptor.direccion}}
                    <div class="info-row">
                        <span class="info-label">Direccion:</span>
                        <span class="info-value">{{if receptor.direccion.complemento}}{{:receptor.direccion.complemento}}{{else}}{{:receptor.direccion}}{{/if}}</span>
                    </div>
                    {{/if}}
                    {{if receptor.telefono}}
                    <div class="info-row">
                        <span class="info-label">Telefono:</span>
                        <span class="info-value">{{:receptor.telefono}}</span>
                    </div>
                    {{/if}}
                    {{if receptor.correo}}
                    <div class="info-row">
                        <span class="info-label">Correo:</span>
                        <span class="info-value">{{:receptor.correo}}</span>
                    </div>
                    {{/if}}
                </div>
            </div>
        </div>
    </div>

    <!-- Tabla de Items -->
    <div class="section">
        <table class="items">
            <thead>
                <tr>
                    <th style="width: 5%;">N</th>
                    <th style="width: 8%;">Cant.</th>
                    <th style="width: 8%;">Unidad</th>
                    <th style="width: 29%;">Descripcion</th>
                    <th style="width: 10%;">Precio Unit.</th>
                    <th style="width: 10%;">Descuento</th>
                    <th style="width: 10%;">No Sujetas</th>
                    <th style="width: 10%;">Exentas</th>
                    <th style="width: 10%;">Gravadas</th>
                </tr>
            </thead>
            <tbody>
                {{for cuerpoDocumento}}
                <tr>
                    <td class="center">{{:numItem}}</td>
                    <td class="center">{{:cantidad}}</td>
                    <td class="center">Unidad</td>
                    <td class="left">{{:descripcion}}</td>
                    <td class="right">{{dec4:precioUni}}</td>
                    <td class="right">{{dec4:montoDescu}}</td>
                    <td class="right">{{dec4:ventaNoSuj}}</td>
                    <td class="right">{{dec4:ventaExenta}}</td>
                    <td class="right">{{dec4:ventaGravada}}</td>
                </tr>
                {{/for}}
            </tbody>
        </table>
    </div>

    <!-- Notas y Resumen -->
    <div class="summary-section">
        <div class="notes-box">
            <strong>Nota:</strong>
            {{:nota}}
        </div>
        <div class="summary-box">
            <div class="summary-row header">
                <span class="summary-label"></span>
                <span class="summary-value" style="width: 70px;">No Sujetas</span>
                <span class="summary-value" style="width: 70px;">Exentas</span>
                <span class="summary-value" style="width: 70px;">Gravadas</span>
            </div>
            <div class="summary-row">
                <span class="summary-label">Suma de Ventas:</span>
                <span class="summary-value" style="width: 70px;">{{dec2:resumen.totalNoSuj}}</span>
                <span class="summary-value" style="width: 70px;">{{dec2:resumen.totalExenta}}</span>
                <span class="summary-value" style="width: 70px;">{{dec2:resumen.totalGravada}}</span>
            </div>
            <div class="summary-row">
                <span class="summary-label">Sumatoria de Ventas:</span>
                <span class="summary-value">{{dec2:resumen.subTotalVentas}}</span>
            </div>
            <div class="summary-row">
                <span class="summary-label">IVA Percibido:</span>
                <span class="summary-value">{{dec2:resumen.ivaPerci1}}</span>
            </div>
            <div class="summary-row">
                <span class="summary-label">Sub-Total:</span>
                <span class="summary-value">{{dec2:resumen.subTotal}}</span>
            </div>
            <div class="summary-row">
                <span class="summary-label">IVA Retenido:</span>
                <span class="summary-value">{{dec2:resumen.ivaRete1}}</span>
            </div>
            <div class="summary-row">
                <span class="summary-label">Retencion Renta:</span>
                <span class="summary-value">{{dec2:resumen.reteRenta}}</span>
            </div>
            <div class="summary-row">
                <span class="summary-label">Monto Total Operacion:</span>
                <span class="summary-value">{{dec2:resumen.montoTotalOperacion}}</span>
            </div>
            <div class="summary-row total">
                <span class="summary-label">TOTAL A PAGAR:</span>
                <span class="summary-value">{{dec2:resumen.totalPagar}}</span>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div class="footer-section">
        <div class="footer-row">
            <div class="footer-item">
                <span class="footer-label">Valor en Letras:</span> {{:resumen.totalLetras}}
            </div>
        </div>
        <div class="footer-row" style="margin-top: 5px;">
            <div class="footer-item">
                <span class="footer-label">Condicion de Operacion:</span> {{:condicionOperacion}}
            </div>
            <div class="footer-item">
                <span class="footer-label">Metodo de Pago:</span> {{:metodoPago}}
            </div>
        </div>
    </div>
</body>
</html>
