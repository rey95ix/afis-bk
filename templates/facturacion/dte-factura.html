<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>{{:nombreFactura}} - {{:identificacion.numeroControl}}</title>
    {{*
        // Converter para 4 decimales (items)
        $.views.converters("dec4", function(val) {
            if (val === null || val === undefined) return "0.0000";
            return Number(val).toFixed(4);
        });

        // Converter para 2 decimales (totales)
        $.views.converters("dec2", function(val) {
            if (val === null || val === undefined) return "0.00";
            return Number(val).toFixed(2);
        });
    }}
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: #f0f2f5;
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 20px;
            color: #333;
            font-size: 12px;
            line-height: 1.4;
        }

        .invoice-container {
            max-width: 1000px;
            margin: 0 auto;
            background: #fff;
            padding: 30px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }

        /* ==================== HEADER ==================== */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .company-info {
            flex: 1;
        }

        .logo {
            height: 50px;
            margin-bottom: 10px;
        }

        .company-details {
            font-size: 11px;
            line-height: 1.4;
            color: #444;
        }

        .contact-info {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-top: 8px;
            color: #0056b3;
            font-size: 12px;
            font-weight: bold;
        }

        .document-type-box {
            border: 2px solid #0056b3;
            border-radius: 8px;
            padding: 10px 20px;
            text-align: center;
            margin: 0 20px;
            min-width: 250px;
        }

        .doc-status {
            font-size: 9px;
            padding: 3px 8px;
            border-radius: 3px;
            margin-bottom: 5px;
            display: inline-block;
        }

        .doc-status.invalid {
            background: #f44336;
            color: white;
        }

        .doc-title {
            font-weight: bold;
            font-size: 14px;
            margin-bottom: 5px;
        }

        .client-code-label {
            font-size: 16px;
            font-weight: bold;
        }

        .client-code-value {
            font-size: 22px;
            font-weight: bold;
            margin: 5px 0;
        }

        .correlative {
            font-size: 11px;
            color: #666;
            margin-bottom: 10px;
        }

        .total-badge {
            background: #1a3a6d;
            color: white;
            padding: 5px 15px;
            border-radius: 4px;
            font-weight: bold;
            display: inline-block;
        }

        .qr-section {
            display: flex;
            gap: 10px;
            align-items: flex-start;
            text-align: right;
        }

        .qr-details {
            font-size: 9px;
            line-height: 1.2;
            color: #555;
        }

        .qr-details span {
            font-weight: bold;
            word-break: break-all;
        }

        .qr-code {
            width: 80px;
            height: 80px;
            border: 1px solid #ddd;
        }

        /* ==================== INFO GRID ==================== */
        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .client-info-card {
            background: #f4f4f4;
            padding: 15px;
            border-radius: 4px;
            font-size: 12px;
            line-height: 1.6;
        }

        .client-info-card .info-row {
            margin-bottom: 3px;
        }

        .payment-summary-card {
            background: #1a3a6d;
            color: white;
            border-radius: 8px;
            overflow: hidden;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 20px;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }

        .main-row {
            font-size: 18px;
            font-weight: bold;
        }

        .sub-row {
            font-size: 16px;
            font-weight: bold;
        }

        .summary-footer {
            display: flex;
            padding: 10px;
            text-align: center;
        }

        .footer-col {
            flex: 1;
        }

        .footer-label {
            font-size: 10px;
            opacity: 0.8;
        }

        .footer-val {
            font-size: 12px;
            font-weight: bold;
        }

        /* ==================== MESSAGE & DOCUMENT BOX ==================== */
        .message-box, .document-body {
            margin-bottom: 20px;
            border-radius: 4px;
            overflow: hidden;
        }

        .box-header {
            background: #3498db;
            color: white;
            text-align: center;
            padding: 6px;
            font-weight: bold;
            font-size: 13px;
        }

        .box-content {
            background: #eef7fd;
            padding: 15px;
            font-size: 11px;
            color: #444;
        }

        /* ==================== TABLE ==================== */
        .table-container {
            position: relative;
            background: #eef7fd;
            min-height: 200px;
        }

        .watermark {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-15deg);
            font-size: 120px;
            font-weight: 900;
            color: rgba(52, 152, 219, 0.1);
            pointer-events: none;
            z-index: 0;
        }

        .invoice-table {
            width: 100%;
            border-collapse: collapse;
            position: relative;
            z-index: 1;
            font-size: 11px;
        }

        .invoice-table th {
            background: #3498db;
            color: white;
            padding: 8px;
            text-align: left;
            font-weight: normal;
        }

        .invoice-table td {
            padding: 10px 8px;
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }

        .invoice-table td.center {
            text-align: center;
        }

        .invoice-table td.right {
            text-align: right;
        }

        /* ==================== BOTTOM SECTION ==================== */
        .bottom-section {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            padding: 20px;
            background: #eef7fd;
        }

        .amount-text {
            font-size: 12px;
            font-weight: bold;
            color: #1a3a6d;
            max-width: 50%;
        }

        .totals-card {
            background: #1a3a6d;
            color: white;
            padding: 15px;
            border-radius: 8px;
            width: 400px;
            font-size: 11px;
        }

        .total-line {
            display: flex;
            justify-content: space-between;
            margin-bottom: 4px;
        }

        .bold-line {
            font-weight: bold;
            font-size: 13px;
            margin-top: 8px;
            border-top: 1px solid rgba(255,255,255,0.2);
            padding-top: 8px;
        }

        /* ==================== NOTES ==================== */
        .notes-box {
            margin-top: 20px;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            background: #f9f9f9;
        }

        .notes-box strong {
            display: block;
            margin-bottom: 5px;
            color: #1a3a6d;
        }

        @media print {
            body {
                background: white;
                padding: 0;
            }
            .invoice-container {
                box-shadow: none;
            }
        }
    </style>
</head>
<body>
<div class="invoice-container">
    <!-- Header Section -->
    <div class="header">
        <div class="company-info">
            {{if logo}}
            <img src="{{:logo}}" alt="Logo" class="logo">
            {{/if}}
            <div class="company-details">
                <strong>{{:emisor.nombre}}</strong><br>
                Dirección: {{:emisor.direccion.complemento}}<br>
                Registro: {{:emisor.nrc}}<br>
                NIT: {{:emisor.nit}}<br>
                Giro: {{:emisor.descActividad}}
            </div>
            <div class="contact-info">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg>
                <span>Contacto: {{:emisor.telefono}}</span>
            </div>
        </div>

        <div class="document-type-box">
            {{if !esValidoMH}}
            <div class="doc-status invalid">NO ES DTE VALIDO - {{:estadoDte}}</div>
            {{/if}}
            <div class="doc-title">{{:nombreFactura}}</div>
            <div class="client-code-label">Código Cliente:</div>
            <div class="client-code-value">{{:codigoCliente}}</div>
            <div class="correlative">Correlativo: {{:correlativo}}</div>
            <div class="total-badge">Total a Pagar: $ {{dec2:resumen.totalPagar}}</div>
        </div>

        <div class="qr-section">
            <div class="qr-details">
                Codigo de Generación: <br><span>{{:identificacion.codigoGeneracion}}</span><br>
                {{if selloRecibido}}
                Sello de Recepción: <br><span>{{:selloRecibido}}</span><br>
                {{/if}}
                Número de Control: <br><span>{{:identificacion.numeroControl}}</span><br>
                Modelo de Facturación: {{:identificacion.tipoModelo}}<br>
                Tipo de Transmisión: {{:identificacion.tipoOperacion}}
            </div>
            {{if qr}}
            <img src="{{:qr}}" alt="QR Code" class="qr-code">
            {{/if}}
        </div>
    </div>

    <!-- Client and Summary Section -->
    <div class="info-grid">
        <div class="client-info-card">
            {{if receptor}}
            <div class="info-row"><strong>Cliente:</strong> {{:receptor.nombre}}</div>
            <div class="info-row"><strong>Dirección:</strong></div>
            {{if receptor.direccion}}
                {{if receptor.direccion.complemento}}
                <div class="info-row">{{:receptor.direccion.complemento}}</div>
                {{else}}
                <div class="info-row">{{:receptor.direccion}}</div>
                {{/if}}
            {{else}}
            <div class="info-row">N/A</div>
            {{/if}}
            {{if esCCF}}
            <div class="info-row"><strong>NIT:</strong> {{:receptor.nit}} | <strong>NRC:</strong> {{:receptor.nrc}}</div>
            {{/if}}
            {{if esFC}}
                {{if receptor.numDocumento}}
                <div class="info-row"><strong>Documento:</strong> {{:receptor.numDocumento}}</div>
                {{/if}}
            {{/if}}
            {{else}}
            <div class="info-row"><strong>Cliente:</strong> Consumidor Final</div>
            {{/if}}
        </div>

        <div class="payment-summary-card">
            <div class="summary-row main-row">
                <div class="summary-label">TOTAL A PAGAR</div>
                <div class="summary-value">$ {{dec2:resumen.totalPagar}}</div>
            </div>
            <div class="summary-row sub-row">
                <div class="summary-label">ULTIMO DIA DE PAGO</div>
                <div class="summary-value">--/--/----</div>
            </div>
            <div class="summary-footer">
                <div class="footer-col">
                    <div class="footer-label">FECHA EMISIÓN</div>
                    <div class="footer-val">{{:identificacion.fecEmi}}</div>
                </div>
                <div class="footer-col">
                    <div class="footer-label">PERIODO FACTURADO</div>
                    <div class="footer-val">N/A</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Message Box -->
    <div class="message-box">
        <div class="box-header">CAJA DE MENSAJES</div>
        <div class="box-content">
            Recuerda que puede hacer sus pagos en todos los puntos de pago de Punto Express, como también por medio de la aplicación (https://app.newtel.com.sv)
        </div>
    </div>

    <!-- Document Body -->
    <div class="document-body">
        <div class="box-header">CUERPO DEL DOCUMENTO</div>
        <div class="table-container">
            <div class="watermark">Newtel</div>
            <table class="invoice-table">
                <thead>
                    <tr>
                        <th>Cant.</th>
                        <th>Unidad</th>
                        <th>Descripción</th>
                        <th>Precio U.</th>
                        <th>Desc. Item</th>
                        <th>No Sujetas</th>
                        <th>Exentas</th>
                        <th>Gravadas</th>
                    </tr>
                </thead>
                <tbody>
                    {{for cuerpoDocumento}}
                    <tr>
                        <td class="center">{{:cantidad}}</td>
                        <td class="center">Unidad</td>
                        <td>{{:descripcion}}</td>
                        <td class="right">$ {{dec4:precioUni}}</td>
                        <td class="right">$ {{dec4:montoDescu}}</td>
                        <td class="right">$ {{dec4:ventaNoSuj}}</td>
                        <td class="right">$ {{dec4:ventaExenta}}</td>
                        <td class="right">$ {{dec4:ventaGravada}}</td>
                    </tr>
                    {{/for}}
                </tbody>
            </table>
        </div>

        <div class="bottom-section">
            <div class="amount-text">
                {{:resumen.totalLetras}}
            </div>
            <div class="totals-card">
                <div class="total-line"><span>Suma Total de Operaciones:</span> <span>$ {{dec2:resumen.subTotalVentas}}</span></div>
                <div class="total-line"><span>Monto global Desc., Rebajas y otros a ventas no sujetas:</span> <span>$ {{dec2:resumen.descuNoSuj}}</span></div>
                <div class="total-line"><span>Monto global Desc., Rebajas y otros a ventas exentas:</span> <span>$ {{dec2:resumen.descuExenta}}</span></div>
                <div class="total-line"><span>Monto global Desc., Rebajas y otros a ventas gravadas:</span> <span>$ {{dec2:resumen.descuGravada}}</span></div>
                <div class="total-line"><span>Sub-Total:</span> <span>$ {{dec2:resumen.subTotal}}</span></div>
                <div class="total-line"><span>IVA Percibido:</span> <span>$ {{dec2:resumen.ivaPerci1}}</span></div>
                <div class="total-line"><span>IVA Retenido:</span> <span>$ {{dec2:resumen.ivaRete1}}</span></div>
                <div class="total-line"><span>Retencion Renta:</span> <span>$ {{dec2:resumen.reteRenta}}</span></div>
                <div class="total-line"><span>Monto Total de la Operación:</span> <span>$ {{dec2:resumen.montoTotalOperacion}}</span></div>
                <div class="total-line"><span>Total Otros montos no afectos:</span> <span>$ {{dec2:resumen.totalNoGravado}}</span></div>
                <div class="total-line bold-line"><span>Total a Pagar:</span> <span>$ {{dec2:resumen.totalPagar}}</span></div>
            </div>
        </div>
    </div>

    <!-- Notas/Observaciones -->
    {{if nota}}
    <div class="notes-box">
        <strong>Observaciones:</strong>
        {{:nota}}
    </div>
    {{/if}}
</div>
</body>
</html>
